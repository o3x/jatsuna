# Changelog

## [7.1.1]
**日時**: Tue Feb 17 21:50:00 JST 2026  
**変更内容**:

### Fixed
- **統計画面のクラッシュ修正**: 古いデータ形式や破損したデータが含まれる場合に統計ダッシュボードが真っ白になる問題を修正。防衛的なプロパティアクセスとデータロード処理の堅牢化を導入。

## [7.1.0]
**日時**: Tue Feb 17 21:40:00 JST 2026  
**変更内容**:

### Added
- **難易度別の戦績統計**: 統計ダッシュボードにタブ機能を追加し、全体および各モード（Easy/Medium...）ごとの平均順位、勝率、最高スコアを個別に表示可能に。
- **データ構造の高度化**: 各モードの戦績を独立して記録する新フォーマットへ移行（互換性維持）。

### Improved
- **Stats Dashboard UI**: タブセレクターを導入し、モバイルでの閲覧性も向上。

## [7.0.0]
**日時**: Tue Feb 17 21:30:00 JST 2026  
**変更内容**:

### Added
- **AI難易度の段階的差別化 (強さの階段)**: 
  - **Easy**: 意図的に弱い（獲得数が少ない）手を選ぶ「接待モード」へ変更。
  - **Hard**: 先読み (Minimax 深度2) と位置評価を組み合わせた。
  - **SuperHard**: より深い探索 (Minimax 深度3) を行い、戦略的な妨害を可能にした。
  - **Medium**: 現行の獲得数重視（貪欲法）を維持し、段階的な難易度を提供。

## [6.9.1]
**日時**: Tue Feb 17 21:20:00 JST 2026  
**変更内容**:

### Fixed
- **ルーレット後のクラッシュ修正**: `Board` コンポーネントのプロップス受け渡し不備による画面真っ白バグを修正。
- **UI表示の補完**: `GameInfo` において AI の思考中ステートが正しく反映されない箇所を修正。

## [6.9.0]
**日時**: Tue Feb 17 21:15:00 JST 2026  
**変更内容**:

### Fixed
- **iOS 音声再生問題の根本解決**: iPhone (Safari/Webview) において音声が再生されない問題を修正。
  - `AudioContext` 初期化時に無音バッファを再生する「アンロック」処理を導入。
  - メニュー画面の「詳細設定」操作時にも音声初期化を走らせることで、ゲーム開始前に確実に音声を有効化。

## [6.8.0]
**日時**: Tue Feb 17 21:00:00 JST 2026  
**変更内容**:

### Added
- **プレミアム・メニューダッシュボード**: メニュー画面を競技ゲームに相応しい洗練されたデザインへ刷新。
- **競技用戦績統計 (Stats Dashboard)**: 平均順位、トップ（1位）率、順位分布、自己ベストなどを可視化。
- **詳細設定モーダル (Settings Modal)**: 歯車アイコンからサウンド、変転スピード（高速/標準）、バリアフリー設定を一括管理可能に。
- **タイポグラフィ刷新**: Google Fonts (`Inter`, `Zen Kaku Gothic New`) を導入し、視認性と高級感を向上。
- **カスタムSVGフェビコン**: 🐍 アイコンをフェビコンとして設定。

### Fixed
- **設定の永続化**: 難易度、サウンド、バリアフリー、アニメーション速度がリロード後も正しく保持されるよう修正。
- **ステート管理の最適化**: ルーレット前後やゲーム再開時の設定引き継ぎロジックを強化。
- **アニメーション連動**: 設定された「変転スピード」が実際の盤面の石に即座に反映されるよう修正。

## [6.7.0]
**日時**: Tue Feb 17 20:30:00 JST 2026  
**変更内容**:

### Added
- **プレミアム・ビジュアル（宝石風）**:
  - 石の表現を Ruby (蛇), Sapphire (蛞蝓), Emerald (蛙) の宝石風グラデーションに刷新。
  - `radial-gradient` と多重の `box-shadow` により、高級感のある質感を実装。
- **バリアフリーモード（色覚多様性対応）**:
  - 設定から「高判別カラー」に切り替え可能。
  - オレンジ（蛇）、スカイブルー（蛞蝓）、パープル（蛙）のコントラストを重視した配色セットを追加。
  - 設定状態は `localStorage` に保存され、次回起動時も維持。

### Refactor
- **ゲームコアの疎結合化（ポータビリティ向上）**:
  - `gameRules.js` および `aiLogic.js` から定数への直接依存を排除。
  - ボードサイズ、三すくみ変換ルール、探索方向などの設定を `JATSUNA_CONFIG` オブジェクトとして引数で渡す設計に刷新。
  - これにより、Unity や Godot 等の他エンジンへのロジック移植が容易になりました。

### Balanced
- **三すくみ（Snake-Slug-Frog）変転ルールの公式化**:
  - **捕食**: 蛇は蛙を、蛞蝓は蛇を、蛙は蛞蝓を石の色に変える。
  - **追放（変転）**: 蛇は蛞蝓を蛙へ、蛞蝓は蛙を蛇へ、蛙は蛇を蛞蝓へと「変質」させるルールを明確化。
  - `constants.js`, `RULEBOOK.md`, `Tutorial.jsx` の整合性を完全に同期。

### Fixed
- **白画面（Whiteout）問題の修正**: `useGameLogic.js` での React hooks インポート漏れを修正。
- **バージョン表記の同期**: ゲーム画面およびドキュメント内のバージョン表記を 6.7.0 に統一。

---

## [6.6.0]
**日時**: Mon Feb 17 19:33:00 JST 2026  
**変更内容**:

### Balanced
- **中央壁(X)の復活**: シミュレーションデータに基づきゲームバランスを大幅改善
  - **問題**: 壁なしでは1番手勝率50.3%（手数16/15/15で不均等）
  - **解決**: 中央マス(3,3)を壁に → 有効45マス÷3=全員15手で均等
  - **高精度検証（v4）**: Top-K選択、3000サンプルでの再検証により、手番勝率差が**5.6%**まで収束することを確認
  - **最適配置の確定**: Wide/Tight/Diagonal/Edgeの比較検証により、現行の「Wide Triangle」が最もバランスが良いことを実証

### Added
- **高精度検証基盤 (v4)**:
  - `scripts/simulate_v4.js`: Top-Kソフトマックス選択、95%信頼区間の算出、多パターン一括検証に対応
  - 合計12,000ゲーム超のシミュレーションによる配置パターンの妥当性証明
  - `docs/balance/` への詳細レポート(#1, #2, #3)蓄積

## [6.5.1]
**日時**: Mon Feb 17 19:01:00 JST 2026  
**変更内容**:

### Fixed
- **ゲーム終了画面のUX改善**: ゲーム終了後のボタン操作を整理しました。
  - **リセットボタンの非表示化**: ゲーム終了後はGameInfo上部のリセットボタンを非表示にし、混乱を防止
  - **2択ボタン化**: Ranking画面に「🔄 もう一度プレイ」（同じ設定でルーレットから再開）と「🏠 メニューに戻る」（設定画面に戻る）の2ボタンを配置

### Added
- **SEO対策**: Google検索やSNS共有に対応しました。
  - meta description / keywords / robots / canonical URL を追加
  - Open Graph (OGP) タグ追加（Facebook, LINE, Discord等でのリンク共有対応）
  - Twitter Card タグ追加
  - JSON-LD 構造化データ（VideoGameスキーマ）追加

## [6.5.0]
**日時**: Mon Feb 17 18:45:00 JST 2026  
**変更内容**:

### Changed
- **メニューレイアウト再設計**: ゲーム設定画面を大幅にシンプル化しました。
  - **手番選択の削除**: 手番は常にランダム（ルーレット）に固定されるようになりました
  - **「形状」トグルの削除**: 石のアイコン（●◆★）が常に表示されるようになりました
  - **設定のアイコンボタン化**: サウンドON/OFFとチュートリアルを画面下部の丸いアイコンボタンに移動しました
  - **GameControls.jsx の軽量化**: propsを10個から4個に削減しました
  - **AI難易度ボタンのコンパクト化**: 3列レイアウトに変更し、ボタンサイズを縮小しました
  - **ボード上の石のアイコン削除**: 石の中の形状アイコン（●◆★）を非表示にし、カラーのみで表示するようにしました

## [6.4.0]
**日時**: Mon Feb 17 17:51:00 JST 2026  
**変更内容**:

### Fixed
- **AI難易度バランスの修正**: `evaluateBoard()` の位置重みテーブルが8×8だったのを、7×7ボードサイズに合わせて修正しました。これにより Hard と SuperHard の評価関数が正しく動作するようになりました。
  - 角(120pt)、辺(20pt)、角の隣(-20～-40pt) を適切に評価
  - Hard と SuperHard の強さが明確に差別化されました

### Changed
- **Medium難易度の調整**: ランダム性を2.0から1.0に縮小し、貪欲法の判断がより反映されるようにしました。

## [6.3.5]
**日時**: Mon Feb 17 17:39:00 JST 2026  
**変更内容**:

### Fixed
- **ゲーム終了サウンド修正**: `Ranking.jsx` に `playOrchestraSound` が渡されていなかったため、ゲーム終了時の順位サウンド（ファンファーレ等）が再生されない問題を修正しました。

### Changed
- **著作権年の更新**: `© 2025` → `© 2025-2026` に更新しました。
- **バージョン同期**: `package.json` のバージョンを `CHANGELOG.md` と同期しました。

### Removed
- **不要ファイルの削除**: Lint実行結果ファイル (`lint.txt`, `lint_compact.txt`, `components_lint.txt`) をリポジトリから削除しました。

## [6.3.4]
**日時**: Sun Feb 08 18:46:00 JST 2026
**変更内容**:

### Refactor
- **ソースコードの完全日本語化**: 英語のコメントやログを全て日本語に翻訳し、可読性を向上させました。
- **Lint設定の追加**: `eslint.config.js` を追加し、コード品質チェックを強化しました。
- **バージョン表記の修正**: アプリケーション内のバージョン表記を修正しました。

## [6.3.3]
**日時**: Wed Dec 03 11:05:00 JST 2025  
**変更内容**:
 
### Documentation
- **AEP Version Checker**: `ae/README.md` の説明を大幅に拡充しました。
  - 内部バージョンとホストバージョンの違いを解説
  - トラブルシューティング情報の追加
  - 技術的な仕組みの解説を追加

## [6.3.2]
**日時**: Wed Nov 27 11:10:00 JST 2025  
**変更内容**:

### Bonus
- **AEP Version Checker**: `ae` フォルダにAfter Effectsのバージョン確認ツールをオマケとして追加しました。

### Changed
- **難易度ボタンの配色改善**: 背景色と同化して見にくかった問題を解消し、難易度を直感的に表現する配色に変更しました
  - **Easy**: 青 (Blue) - 冷静・安全
  - **Medium**: エメラルド (Emerald) - 中間・安定
  - **Hard**: 赤 (Red) - 危険・高難易度
  - **Super**: フクシア (Fuchsia) - 超越・高貴
  - **Ultimate**: 黒赤グラデーション (Black-Red) - 最凶・絶望

## [6.3.1]
**日時**: Wed Nov 27 10:45:00 JST 2025  
**変更内容**:

### Fixed
- **クリック不可バグの完全修正**: 自分の手番時にボードがグレーアウトしてクリックできない問題を修正しました
  - `Board`コンポーネントに`isPlayerTurn`プロップが渡されていなかった問題を修正
  - プレイヤーの手番時にボードが正しくアクティブになるようになりました

## [6.3.0]
**日時**: Wed Nov 27 10:35:00 JST 2025  
**変更内容**:

### Changed
- **チュートリアル表示方法の変更**: 初回起動時の自動表示を無効化し、ボタンで表示する方式に変更しました
  - ゲーム設定画面に「📚 チュートリアル」ボタンを追加
  - 初回起動時にチュートリアルが自動的に表示されなくなりました
  - ユーザーが必要な時にチュートリアルを表示できるようになりました

## [6.2.1]
**日時**: Wed Nov 27 10:31:00 JST 2025  
**変更内容**:

### Fixed
- **クリックバグ修正**: バージョン6.2.0で発生していた、自分の手番時にどこもクリックできない問題を修正しました
  - `resetGame()`関数内の`gameStarted`フラグの状態管理を修正
  - `setGameStarted(false)`を削除し、即座に`setGameStarted(true)`を設定するように変更

## [6.2.0]
**日時**: Wed Nov 27 10:25:00 JST 2025  
**変更内容**:

### Added
- **インタラクティブチュートリアル**: 初回起動時に新規プレイヤー向けのチュートリアルが自動表示されるようになりました
  - 6ステップのわかりやすいガイド
  - ゲームルールと操作方法の説明
  - スキップ機能付き
  - LocalStorageで完了状態を保存（2回目以降は表示されません）
  - モーダルオーバーレイで視認性向上

### Fixed
- **App.jsx構造の修正**: ファイル内の重複コードを削除し、正しいJSX構造に修正しました

## [6.1.3]
**日時**: Sun Nov 24 19:09:00 JST 2025  
**変更内容**:

### Changed
- **石のデザイン改善**: オーブ、ジェム、ステラの石を3Dグラデーション、影、光沢で格好良く改善しました
  - 放射状グラデーション（radial-gradient）で立体感を演出
  - 内側の光沢（inset box-shadow）で宝石のような輝き
  - 外側の影（box-shadow）で浮き上がる効果

## [6.1.2]
**日時**: Sun Nov 24 19:05:00 JST 2025  
**変更内容**:

### Added
- **ルーレット音**: 手番決定のルーレット回転時に音が鳴るようになりました

### Changed
- **AI難易度の調整**: EasyとMediumの難易度を弱く調整しました
  - Medium: ランダム性を増加（0.5 → 2.0）して、より勝ちやすく

### Fixed
- **Ranking無限ループ修正**: ゲーム終了時に真っ白画面になる問題を修正しました

## [6.1.1]
**日時**: Sun Nov 24 18:50:00 JST 2025  
**変更内容**:

### Added
- **オーケストラルサウンドシステム**: 旧バージョン（v5.4）の高品質なサウンドを完全移植
  - **石を置く音**:
    - キャプチャなし: シンプルな配置音
    - 1-3個: マリンバ風サウンド（リバーブ付き）
    - 4個以上: オーケストラヒット
  - **エンディング音楽（順位別）**:
    - 🥇 1位: 華やかな上昇和音（ファンファーレ）
    - 🥈 2位: 穏やかな銀メダル音
    - 🤝 引き分け: 平板な中立音
    - 🥉 3位: 悲しい下降音
  - **iOS対応**: AudioContextの永続化とサスペンド状態の自動resume()

## [6.1.0]
**日時**: Sun Nov 24 16:30:00 JST 2025  
**変更内容**:

### Balanced
- **初期配置の変更**: AIシミュレーションの結果に基づき、ゲームバランスを公平化するために初期配置を変更しました。
    - 旧: 中央に密集し、壁(X)が存在する配置（1番手必勝）
    - 新: "Wide Triangle" 配置。3人が三角形に距離を取って配置され、壁(X)を削除。これにより各プレイヤーの勝率が均衡しました。

### Changed
- **ルーレットの短縮**: 手番決めのルーレットアニメーションを約3秒に短縮し、テンポを向上させました。
- **UIレイアウト修正**:
    - 画面全体の高さを固定し、操作ごとの不快なスクロール（レイアウトシフト）を防止しました。
    - AI「思考中」メッセージの表示領域を固定し、表示/非表示による画面のガタつきを解消しました。
- **AIロジックの分離**: AIの思考ロジックを `src/utils/aiLogic.js` に分離し、Node.js環境でのシミュレーションを可能にしました。

## [6.0.0]
**日時**: Sun Nov 24 10:00:00 JST 2025  
**変更内容**:

### Added
- **Reactリファクタリング**: 従来のHTML1ファイル構成から、Vite + Reactによるモダンな構成へ完全移行しました。
- **AI難易度設定**:
    - **Easy**: ランダム
    - **Medium**: 貪欲法（獲得数重視）
    - **Hard**: 位置評価重視
    - **SuperHard**: 1手読み + 高度な評価関数
    - **Ultimate**: 最凶結託モード（既存機能の移植）
- **合法手の可視化**: 石を置ける場所に黄色いマーカーと点滅アニメーションを追加し、視認性を向上させました。

### Fixed
- **ルーレット機能**: React移行時に一時的に動作しなくなっていたルーレット機能を復旧・改善しました。

---

## Version 5.6.1 - iOS Audio Fix Edition
**日時**: 2025-11-09 19:09  
**変更内容**:

### 📱 iOS音声問題の完全解決
- AudioContextの永続化（useRefフック導入）
- 初期化タイミングの最適化（ゲーム開始時・石配置時）
- サスペンド状態の明示的なresume()呼び出し
- iOS Web Audio API制約への完全対応

---

## Version 5.6 - Ultimate Collusion Edition
**日時**: 2025-11-08 16:30  
**変更内容**:

### 👿 Gemini版の最強アルゴリズムを統合
- 超強力な結託評価関数（プレイヤースコア4倍重み、選択肢制限8倍重み）
- ミニマックス探索の最適化（深度4、Alpha-Beta枝刈り）
- 視覚効果の強化（evil-glow、collusion-pulse）
- サウンド改善（邪悪な音、極低音）

---

## Version 5.5 - Collusion Mode Edition
**日時**: 2025-11-08 13:45  
**変更内容**:

### 😈 いかさま最強モード実装
- AI同士の結託システム（2体のAIがプレイヤーを共通の敵として認識）
- 強化された思考能力（3-4手先読み）
- 専用ボタンデザイン（赤黒グラデーション、邪悪な光るエフェクト）

---

## Version 5.4.3 - Bug Fix Edition
**日時**: 2025-11-06 17:20  
**変更内容**:

### 🐛 重大なバグ修正
- ルーレット後の初手で打てない問題を修正
- `gameStarted`フラグの設定タイミングを最適化

---

## Version 5.4.2 - Shape Names Edition
**日時**: 2025-11-05 09:03  
**変更内容**:

### 🔮 名称システムの大幅改革
- オレンジ → オーブ（Orb）●
- シアン → ジェム（Gem）◆
- パープル → ステラ（Stella）★

---

## Version 5.4.1 - Victory Fix Edition
**日時**: 2025-11-05 08:45  
**変更内容**:

### 🐛 重要なバグ修正
- プレイヤー色の判定バグを修正
- 手番位置に基づいて正しいプレイヤー色を判定

---

## Version 5.4 - Victory Display Edition
**日時**: 2025-11-05 08:39  
**変更内容**:

### 🏆 勝利判定とランキング表示の大幅改善
- 最終ランキング表の追加（メダル表示）
- ユーザー順位の強調（黄色いリング）
- 勝敗メッセージの改善

---

## Version 5.3 - Rulebook Edition
**日時**: 2025-11-05 01:00  
**変更内容**:

### 📚 公式ルールブック作成
- Markdownバージョン作成
- HTMLバージョン作成（レスポンシブデザイン）

---

## Version 5.2 Fixed - Turn Management Fix
**日時**: 2025-11-05 00:05  
**変更内容**:

### 🐛 致命的なバグ修正
- 手番管理の完全修正
- 勝者表示の改善
- デフォルト設定を「ルーレット」に変更

---

## Version 5.2 - Super Hard AI & Orchestral Sound
**日時**: 2025-11-04  
**変更内容**:

### 🤖 Super Hard AI実装
- ミニマックス法導入（2-3手先読み）
- Alpha-Beta枝刈りで高速化

### 🎵 オーケストラルサウンド実装
- マリンバ風サウンド
- オーケストラヒット
- リアルな石の音

---

## Version 5.1 - Shape System & Basic Sound
**日時**: 2025-11-04  
**変更内容**:

### 🔮 形状による識別システム
- 3種類の石の形状（●◆★）
- CSS clip-path実装

### 🔊 基本的なサウンドシステム
- Web Audio APIで生成
- 勝利音/敗北音

---

## Version 5.0 - Universal Design
**日時**: 2025-11-04  
**変更内容**:

### ♿ ユニバーサルデザイン対応
- 色覚多様性への配慮
- アクセシビリティ向上

---

## Version 4.1 - Balance Optimization
**日時**: 2025-11-03 22:01  
**変更内容**:

### 📏 中心固定方式採用
- 7×7ボード改革（中央1マスを固定）
- 初期配置の再調整
- 手番均等化達成（各プレイヤー15手）

---

## Version 4.0 - Feature Enhancement
**日時**: 2025-11-03 13:23  
**変更内容**:

### 🎮 主要機能追加
- ボードサイズ選択（7×7/9×9）
- AI難易度3段階
- キャプチャ予告表示
- アニメーション効果
- サウンドシステム

---

## Version 3.0 - Optimal Balance Discovery
**日時**: 2025-11-03 17:40  
**変更内容**:

### 🔬 大規模シミュレーション実施
- 15パターン×1000ゲーム検証
- Sparse Triangle配置採用
- 勝率スプレッド43.6% → 6.6%の大改善

---

## Version 2.1 - Triangle Placement
**日時**: 2025-11-03 17:27  
**変更内容**:

### 🔺 初期配置を三角形に変更
- 横一列配置の問題を解決
- より戦略的なゲーム展開

---

## Version 2.0 - Initial Placement Addition
**日時**: 2025-11-03 16:51  
**変更内容**:

### 🎯 初期配置の追加
- 中央横一列配置（R-G-B）

---

## Version 1.0 - Initial Release
**日時**: 2025-11-03 16:38  
**変更内容**:

### 🎉 初期リリース
- 基本ゲームシステム（9×9ボード）
- 3人プレイ（プレイヤー1人 + AI 2体）
- 色変換ルール（R→G→B→R）
- 基本AI（貪欲法）

---

*© 2025 蛇突奈 (Jatsuna)*  
*開発: Claude, Gemini & OHYAMA, Yoshihisa (o3x) Collaboration*